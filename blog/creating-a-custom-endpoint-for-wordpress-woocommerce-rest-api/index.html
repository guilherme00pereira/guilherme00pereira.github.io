<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <title>&lt;/G28&gt;</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="This is meta description">
  
  <meta name="author" content="Guilherme Pereira">
  <meta name="generator" content="Hugo 0.59.1" />

  <!-- plugins -->
  
  <link rel="stylesheet" href="https://guilherme00pereira.github.io/plugins/bootstrap/bootstrap.min.css ">
  
  <link rel="stylesheet" href="https://guilherme00pereira.github.io/plugins/slick/slick.css ">
  
  <link rel="stylesheet" href="https://guilherme00pereira.github.io/plugins/themify-icons/themify-icons.css ">
  
  <link rel="stylesheet" href="https://guilherme00pereira.github.io/plugins/venobox/venobox.css ">
  

  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="https://guilherme00pereira.github.io/scss/style.min.css" integrity="" media="screen">

  <!--Favicon-->
  <link rel="shortcut icon" href="https://guilherme00pereira.github.io/images/favicon.png " type="image/x-icon">
  <link rel="icon" href="https://guilherme00pereira.github.io/images/favicon.png " type="image/x-icon">

</head><body>
<!-- preloader start -->
<div class="preloader">
  
</div>
<!-- preloader end -->
<!-- navigation -->
<header class="navigation">
  <div class="container">
    
    <nav class="navbar navbar-expand-lg navbar-white bg-transparent border-bottom">
      <a class="navbar-brand mobile-view" href="https://guilherme00pereira.github.io/"><img class="img-fluid"
          src="https://guilherme00pereira.github.io/images/logo.png" alt="&lt;/G28&gt;"></a>
      <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navigation">
        <i class="ti-menu h3"></i>
      </button>

      <div class="collapse navbar-collapse text-center" id="navigation">
        

        <a class="navbar-brand mx-auto desktop-view" href="https://guilherme00pereira.github.io/"><img class="img-fluid"
            src="https://guilherme00pereira.github.io/images/logo.png" alt="&lt;/G28&gt;"></a>

        <ul class="navbar-nav ml-auto">
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://guilherme00pereira.github.io/blog">Articles</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://guilherme00pereira.github.io/about">About</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://guilherme00pereira.github.io/contact">Contact</a>
          </li>
          
          
          
            
            <li class="nav-item">
                <a class="nav-link top-lang" href="https://guilherme00pereira.github.io/pt/blog/creating-a-custom-endpoint-for-wordpress-woocommerce-rest-api/">pt</a>
            </li>
            
        
        </ul>

        
        <!-- search -->
        <div class="search px-4">
          <button id="searchOpen" class="search-btn"><i class="ti-search"></i></button>
          <div class="search-wrapper">
            <form action="https://guilherme00pereira.github.io//search" class="h-100">
              <input class="search-box px-4" id="search-query" name="s" type="search" placeholder="Type & Hit Enter...">
            </form>
            <button id="searchClose" class="search-close"><i class="ti-close text-dark"></i></button>
          </div>
        </div>
        

        
      </div>
    </nav>
  </div>
</header>
<!-- /navigation -->

<section class="section-sm">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        
        <a href="/categories/wordpress"
          class="text-primary">Wordpress</a>
        
        <h2>Creating a Custom Endpoint for WordPress / WooCommerce REST API</h2>
        <div class="mb-3"><span>By Guilherme Pereira</span> <span
            class="border-bottom border-primary px-2 mx-1"></span>
          <span>09 April 2019</span></div>
        <img src="https://guilherme00pereira.github.io/images/woocommerce.jpg" class="img-fluid w-100 mb-4" alt="Creating a Custom Endpoint for WordPress / WooCommerce REST API">
        <div class="content mb-5">
          

<p>WooCommerce has a REST API fully integrated with the WordPress API, which allows us to make requests in JSON format to create, read, modify and erase data from our store. However, sometimes we need to extend this API by creating custom endpoints to return certain types of data.</p>

<p>In this tutorial, I&rsquo;ll show you step-by-step how to create a simple custom endpoint and hopefully this will be useful as a starting point for more complex calls.</p>

<h3 id="creating-the-plugin">Creating the Plugin</h3>

<p>First of all, we will create our WordPress plugin. <a href="https://codex.wordpress.org/Writing_a_Plugin" target="_blank">WordPress docs</a> give us a full explanation about how to create your own plugin, but basically what we have to do is to create a folder inside <strong>wp-content/plugins</strong> directory, and give it a name:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">mkdir woocommerce-custom-api-endpoint <span style="color:#f92672">&amp;&amp;</span> cd woocommerce-custom-api-endpoint</code></pre></div>

<p>Inside that folder, we create a file with the same folder&rsquo;s name, and it&rsquo;ll contain our base code:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">touch woocommerce-custom-api-endpoint.php</code></pre></div>

<h3 id="the-basic-structure">The Basic Structure</h3>

<p>Now, in the file that we created we will write the following code, with the following parts (1, 2 and 3) that i will explain next:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">&lt;?php</span>

<span style="color:#75715e">// (1)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span> <span style="color:#a6e22e">defined</span>( <span style="color:#e6db74">&#39;ABSPATH&#39;</span> ) ) {
	<span style="color:#66d9ef">exit</span>;
}

<span style="color:#75715e">// (2)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">register_custom_routes</span>() {

}

<span style="color:#75715e">// (3)
</span><span style="color:#75715e"></span><span style="color:#a6e22e">add_action</span>(<span style="color:#e6db74">&#39;rest_api_init&#39;</span>, <span style="color:#e6db74">&#39;register_custom_routes&#39;</span>);

<span style="color:#75715e">?&gt;</span>
</code></pre></div>

<p>The first part (1) of the code avoids direct access to the file. Then (2), we define a function that will make the call to the class method <strong>WC_Custom_Endpoints</strong>  that we will create in the next step, where the routes of our API will be configured. In step (3) we will be registering our endpoints through the hook <a href="https://developer.wordpress.org/reference/hooks/rest_api_init/" target="_blank">rest_api_init</a>, passing as parameter the created function.</p>

<h3 id="wc-custom-endpoints-class">WC_Custom_Endpoints Class</h3>

<p>Now let&rsquo;s create a new file that will contain our <strong>WC_Custom_Endpoints</strong> class, which will be the methods that will handle calls to our API. To copy a call to our API, we will create an endpoint that will return the list of the items present in the orders with status &ldquo;Processing&rdquo;, i.e., orders already paid and pending to be separated for sending, which will give us an overview of the quantity of each item to be separated. For this we will define our class with the following methods:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">&lt;?php</span>

<span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span> <span style="color:#a6e22e">defined</span>( <span style="color:#e6db74">&#39;ABSPATH&#39;</span> ) ) {
	<span style="color:#66d9ef">exit</span>;
}

                                 <span style="color:#75715e">// (1)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">WC_Custom_Endpoint</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">WP_REST_Controller</span>{

  <span style="color:#75715e">// (2)
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">private</span> $local_wpdb;

  <span style="color:#75715e">// (3)
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> __construct() {
    <span style="color:#66d9ef">global</span> $wpdb;
    $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">local_wpdb</span> <span style="color:#f92672">=</span> $wpdb;
  }

  <span style="color:#75715e">// (4)
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">register_routes</span>() {

  }

  <span style="color:#75715e">// (5)
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">processing_order_items</span>() {
        
  }
}

<span style="color:#75715e">?&gt;</span>
</code></pre></div>

<p>We then create the <strong>WC_Custom_Endpoints</strong> class in a new file. Let&rsquo;s create a folder called includes, and within it we will create the file <strong>class-wc-custom-api-endpoints.php</strong>. We will extend the <a href="https://developer.wordpress.org/reference/classes/wp_rest_controller/" target="_blank">WP_REST_Controller</a> (1) class, from which we will inherit the <strong>&ldquo;register_routes&rdquo;</strong> method (4), which will register our example route. We will also declare a private property <strong>$local_wpdb</strong>(2), which will be instantiated in our class constructor (3) method. The <a href="https://codex.wordpress.org/Class_Reference/wpdb" target="_blank">wpdb</a> class of WordPress contains features to interact with the database and we will use it to execute a query that will return the data we need. For this we create the method called <strong>processing_order_items</strong> (5).</p>

<p>To register our endpoint, we will declare a variable that will contain our namespace and call the <a href="https://developer.wordpress.org/reference/functions/register_rest_route/" target="_blank">register_rest_route</a> function, passing the namespace, route definition, and arguments as an array with parameters. This array will contain another array with options &lsquo;methods&rsquo; and &lsquo;callback&rsquo;. Since we will make a GET call, we will use the READABLE constant of the <strong>WP_REST_Server</strong> class. In the callback we will pass our method that will return the items of the orders.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">&lt;?php</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">register_routes</span>() {
  $namespace <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;customapi/v1&#39;</span>;
  <span style="color:#a6e22e">register_rest_route</span>($namespace, <span style="color:#e6db74">&#39;/processing_order_items&#39;</span>, <span style="color:#66d9ef">array</span>(
	<span style="color:#66d9ef">array</span>(
		<span style="color:#e6db74">&#39;methods&#39;</span> 	<span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">WP_REST_Server</span><span style="color:#f92672">::</span><span style="color:#a6e22e">READABLE</span>,
		<span style="color:#e6db74">&#39;callback&#39;</span>	<span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>( $this, <span style="color:#e6db74">&#39;processing_order_items&#39;</span> )
	)
  ));
}
</code></pre></div>

<p>That done, we will now do the SQL query within the method to access the database.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">&lt;?php</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">processing_order_items</span>() {
        $sql <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SELECT woi.order_id, woi.order_item_name AS item_name, 
</span><span style="color:#e6db74">		MAX(IF(wom.meta_key = &#39;_qty&#39;, wom.meta_value, NULL)) AS qty FROM wpsu_woocommerce_order_items woi
</span><span style="color:#e6db74">		INNER JOIN wpsu_woocommerce_order_itemmeta wom 
</span><span style="color:#e6db74">		ON wom.order_item_id = woi.order_item_id
</span><span style="color:#e6db74">		WHERE woi.order_id IN 
</span><span style="color:#e6db74">		(SELECT ID FROM wpsu_posts WHERE post_status = &#39;wc-processing&#39; AND post_type = &#39;shop_order&#39;)
</span><span style="color:#e6db74">		AND woi.order_item_type = &#39;line_item&#39;
</span><span style="color:#e6db74">		GROUP BY woi.order_item_name&#34;</span>;
        $result <span style="color:#f92672">=</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">local_wpdb</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">get_results</span>($sql);
        <span style="color:#66d9ef">return</span> $result;
	}
</code></pre></div>

<p>Okay, our endpoint is now almost done. We just needed to go back to the base file of our plugin, <strong>woocommerce-custom-api-endpoint.php</strong>, and add the following code inside the <strong>register_custom_routes</strong> function, and include the <strong>WC_Custom_Endpoint</strong> class, as follows:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">&lt;?php</span>
<span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span> <span style="color:#a6e22e">defined</span>( <span style="color:#e6db74">&#39;ABSPATH&#39;</span> ) ) {
	<span style="color:#66d9ef">exit</span>; <span style="color:#75715e">// Exit if accessed directly.
</span><span style="color:#75715e"></span>}

<span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span> <span style="color:#a6e22e">class_exists</span>( <span style="color:#e6db74">&#39;WC_Custom_Endpoint&#39;</span> ) ) {
    <span style="color:#66d9ef">include_once</span> <span style="color:#a6e22e">dirname</span>( <span style="color:#66d9ef">__FILE__</span> ) <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;/includes/class-wc-custom-api-endpoints.php&#39;</span>;
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">register_custom_routes</span>() {
    $controller <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">WC_Custom_Endpoint</span>();    
    $controller<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">register_routes</span>();
}

<span style="color:#a6e22e">add_action</span>(<span style="color:#e6db74">&#39;rest_api_init&#39;</span>, <span style="color:#e6db74">&#39;register_custom_routes&#39;</span>);
</code></pre></div>

<p>Now we call our endpoint:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">curl <span style="color:#e6db74">&#34;http://www.seusite.com/wp-json/customapi/v1/processing_order_items</span></code></pre></div>

<p>This is a basic example, we could extend this article by addressing other issues, such as authentication to hold the call, but this will be subject to a future post.</p>

<p>See ya!</p>

        </div>

        
        
      </div>
    </div>
  </div>
</section>



<footer>
  <div class="container">
    <div class="row">
      <div class="col-12 text-center mb-5">
        <a href="https://guilherme00pereira.github.io/"><img src="https://guilherme00pereira.github.io/images/logo.png" alt="&lt;/G28&gt;"></a>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Contact Me</h6>
        <ul class="list-unstyled">
          <li class="mb-3"><a class="text-dark" href="https://wa.me/55-31-998220669/?text=Ol%c3%a1%2c%20estou%20entrando%20em%20contato%20atrav%c3%a9s%20do%20blog." target="_blank"><i
                class="ti-mobile mr-3 text-primary"></i>55-31-998220669</a></li>
          <li class="mb-3"><i class="ti-location-pin mr-3 text-primary"></i>Belo Horizonte, Brazil</li>
          <li class="mb-3"><a class="text-dark" href="mailto:guilherme00pereira@gmail.com"><i
                class="ti-email mr-3 text-primary"></i>guilherme00pereira@gmail.com</a>
          </li>
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Social Contacts</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="https://twitter.com/guilherme00per1" target="_blank">twitter</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://stackexchange.com/users/14371444/guilherme-pereira" target="_blank">stack overflow</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://github.com/guilherme00pereira" target="_blank">github</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://www.linkedin.com/in/guilhermepereirasalves/" target="_blank">linkedin</a></li>
          
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Categories</h6>
        <ul class="list-unstyled">
          <li class="mb-3"><a class="text-dark"
              href="/categories/wordpress">Wordpress</a>
          </li>
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Quick Links</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="https://guilherme00pereira.github.io/blog">Articles</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://guilherme00pereira.github.io/about">About</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://guilherme00pereira.github.io/contact">Contact</a></li>
          
        </ul>
      </div>
      <div class="col-12 border-top py-4 text-center">
        | @2019 All Rights Reserved |
      </div>
    </div>
  </div>
</footer>

<script>
  var indexURL = "https://guilherme00pereira.github.io/index.json"
</script>

<!-- Google Map API -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCcABaamniA6OL5YvYSpB3pFMNrXwXnLwU&amp;libraries=places"></script>
<!-- JS Plugins -->

<script src="https://guilherme00pereira.github.io/plugins/jQuery/jquery.min.js"></script>

<script src="https://guilherme00pereira.github.io/plugins/bootstrap/bootstrap.min.js"></script>

<script src="https://guilherme00pereira.github.io/plugins/slick/slick.min.js"></script>

<script src="https://guilherme00pereira.github.io/plugins/venobox/venobox.min.js"></script>

<script src="https://guilherme00pereira.github.io/plugins/search/fuse.min.js"></script>

<script src="https://guilherme00pereira.github.io/plugins/search/mark.js"></script>

<script src="https://guilherme00pereira.github.io/plugins/search/search.js"></script>

<script src="https://guilherme00pereira.github.io/plugins/google-map/gmap.js"></script>

<!-- Main Script -->

<script src="https://guilherme00pereira.github.io/js/script.min.js"></script>
<!-- google analitycs -->
<script>
  (function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function () {
      (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o),
      m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
  })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
  ga('create', 'UA-136835996-1', 'auto');
  ga('send', 'pageview');
</script></body>
</html>